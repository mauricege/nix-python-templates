{%- from pathjoin('includes', 'next-major-version.jinja') import next_major_version %}
[project]
name = "{{ project_name }}"
version = "0.0.1"
description = "{{ project_description }}"
requires-python = ">={{ python_version }}, <{{ next_major_version(python_version) }}"
dependencies = [
    {%- if install_flash_attention %}
    "torch",
    "flash-attn",
    {%- endif %}
    {%- for pkg in python_packages.replace(',', ' ').split() %}
    "{{ pkg }}",
    {%- endfor %}
]
{% if python_package_manager == 'uv' %}
[tool.uv]
dev-dependencies = ["ruff"]
{% if install_flash_attention %}
[tool.uv.extra-build-dependencies]
flash-attn = [{ requirement = "torch", match-runtime = true }]

[tool.uv.extra-build-variables]
flash-attn = { FLASH_ATTENTION_SKIP_CUDA_BUILD = "TRUE" }
{%- endif %}
{% endif %}
{% if python_package_manager == 'micromamba' %}
{%- endif %}
{% if python_package_manager == 'pixi' %}
[tool.pixi.workspace]
channels = ["conda-forge", "pytorch", "nvidia"]
platforms = ["linux-64"]

[tool.pixi.system-requirements]
{% if cudaSupport %}
cuda = "12.0"
{%- endif %}
[tool.pixi.dependencies]
{%- set py_parts = python_version.split('.') %}
python = "{% if py_parts|length == 2 %}{{ python_version }}.*{% else %}{{ python_version }}{% endif %}"
{%- for pkg in python_packages.replace(',', ' ').split() %}
{{ pkg.split('=')[0] }} = "{{ pkg.split('=')[1] if '=' in pkg else '*' }}"
{%- endfor %}
{%- endif %}
